    \p
ابتدا به بررسی حالت‌های نامطلوب جهت حذف کردن از تعداد حالات کلی می‌پردازیم. در این مسئله، حالت نامطلوب زمانی اتفاق می‌افتد که حداقل یک دسته‌ وجود داشته باشد که اعداد روی هر سه توپ یکسان باشند. بنابراین روی تعداد دسته‌هایی که می‌توانند این ویژگی را داشته باشند حالت بندی می‌کنیم.
$P(i)$
را تعداد راه‌های دسته‌بندی توپ‌ها 
در حالتی که
اعداد روی هر سه توپ 
   $i$
دسته, یکسان باشند,در نظر می‌گیریم.

 پاسخ مسئله 
را $N$
و تعداد کل راه‌های دسته‌بندی
به طوری که حداقل یک دسته‌ وجود داشته باشد که اعداد روی هر سه توپ یکسان باشند، 
 را
 $A$ 
 می‌نامیم. در نتیجه پاسخ مسئله به صورت زیر محاسبه‌ می‌شود:
$$N = P(0) - A$$
همچنین طبق اصل شمول و عدم شمول برای محاسبه‌ی 
$A$
داریم:
$$A = P(1) - P(2) + P(3) - ... + (-1)^{n-1}P(n)$$
$$= \sum\limits_{i = 1}^n (-1)^{i-1} P(i)$$
برای به دست آوردن مقدار 
$P(i)$
به صورت زیر عمل می‌کنیم:

	    1.
    	$i$
    	 عدد را انتخاب می‌کنیم تا در 
    	 $i$
    	  دسته قرار بگیرند.
    	
		 2.
        بقیه اعداد را در یک ردیف می‌چینیم.
    	
		 3.
    	 و چون ترتیب اعداد درون دسته‌ها بی‌اهمیت است، باید تقسیم بر $(3!)^{n-i}$ کنیم.
    	
		 4.
    	 از اول ردیف سه‌تا سه‌تا توپ‌ها را در یک دسته قرار می‌دهیم. در این صورت $n - i$ دسته (غیر از 
    	$i$ 
    	دستهٔ اولی که جدا کردیم) داریم. ولی جایگشت این دسته‌ها برای ما اهمیتی ندارد؛ بنابراین باید جواب را بر $(n-i)!$ تقسیم کنیم.
    	$$P(i) = \underbrace{{n  \choose i}}_1\underbrace{(3n - 3i)!}_2\underbrace{\frac{1}{(3!)^{n - i}}}_3 \underbrace{\frac{1}{(n - i)!}}_4$$


    در نهایت $N$ 
    را به صورت زیر به دست می‌آوریم:
	$$N = P(0) - A = P(0) - \sum\limits_{i = 1}^n (-1)^{i-1} P(i) = \sum\limits_{i = 0}^n (-1)^{i} P(i)$$
	$$= \sum\limits_{i = 0}^n (-1)^i {n \choose i} \frac{1}{(n - i)!} \frac{(3n - 3i)!}{(3!)^{n - i}}$$

    \p
	از طرفی تعداد کل حالات به صورت زیر خواهد بود:
	
	$$\frac{1}{n!} \frac{(3n)!}{(3!)^n}$$
	
	در واقع برای محاسبه‌ی تعداد حالات کل، به این صورت که $3n$ توپ را در یک ردیف می‌چینیم و چون جایگشت دسته‌ها اهمیتی ندارد, تقسیم بر $n!$ می‌کنیم.
	
    \p
	بنابراین طبق اصل شمول و عدم شمول حالات مطلوب برابر خواهد بود با:
	$$\sum\limits_{i = 0}^n (-1)^i {n \choose i} \frac{1}{(n - i)!} \frac{(3n - 3i)!}{(3!)^{n - i}}$$
